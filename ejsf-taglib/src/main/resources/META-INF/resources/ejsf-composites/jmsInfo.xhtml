<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:composite="http://java.sun.com/jsf/composite"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>This content will not be displayed</title>
    </h:head>
    <h:body>
        <composite:interface shortDescription="Displays information about JMS."
                             componentType="ejsf.jmsInfo">
            <composite:attribute name="queue"
                                 required="true"
                                 shortDescription="The JMS queue."
                                 type="java.lang.String"/>
            <composite:attribute name="replayQueue"
                                 shortDescription="The optional JMS queue used to replay JMS messages."
                                 type="java.lang.String"/>
            <composite:attribute name="requiredRole"
                                 shortDescription="The optional required RBAC role."
                                 type="java.lang.String"/>
        </composite:interface>
        <composite:implementation>
            <div id="#{cc.clientId}">
                <p:panel header="#{cc.attrs.queue}">
                    <f:facet name="options">
                        <p:menu>
                            <p:submenu label="Settings">
                                <p:menuitem value="Refresh" icon="pi pi-refresh" action="#{cc.refresh()}" update="@form"/>
                            </p:submenu>
                        </p:menu>
                    </f:facet>
                    <ui:fragment rendered="#{not cc.error}">
                        <h:panelGrid columns="2">
                            <h:outputText value="Message count:"/>
                            <h:outputText value="#{cc.messageCount}"/>

                            <h:outputText value="Consumer count:"/>
                            <h:outputText value="#{cc.consumerCount}"/>

                            <h:outputText value="Messages added:"/>
                            <h:outputText value="#{cc.messagesAdded}"/>

                            <h:outputText value="Delivery count:"/>
                            <h:outputText value="#{cc.deliveryCount}"/>

                            <h:outputText value="Dead letter address:"/>
                            <h:outputText value="#{cc.deadLetterAddress}"/>

                            <h:outputText value="Expiry address:"/>
                            <h:outputText value="#{cc.expiryAddress}"/>

                            <h:outputText value="Queue address:"/>
                            <h:outputText value="#{cc.queueAddress}"/>

                            <h:outputText value="Replay queue:" rendered="#{cc.replay}"/>
                            <h:outputText value="#{cc.attrs.replayQueue}" rendered="#{cc.replay}"/>
                        </h:panelGrid>
                        <p:spacer height="10px"/>
                        <p:dataTable value="#{cc.jmsMessages}" var="jmsMessage"
                                     rows="10" paginator="true" paginatorPosition="bottom"
                                     lazy="false">
                            <f:facet name="header">
                                JMS Messages in queue #{cc.attrs.queue}
                            </f:facet>
                            <p:column headerText="Identifier">
                                #{jmsMessage.id}
                            </p:column>
                            <p:column headerText="Timestamp">
                                <h:outputText value="#{jmsMessage.timestamp}">
                                    <f:convertDateTime type="both" timeStyle="full" />
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Actions" rendered="#{cc.replay}">
                                <p:commandButton icon="pi pi-replay"
                                                 styleClass="rounded-button ui-button-flat"
                                                 update="@form"
                                                 action="#{cc.replayMessage(jmsMessage)}"/>
                                <p:tooltip for="@previous" value="Replay JMS message."/>

                                <p:commandButton icon="pi pi-trash"
                                                 styleClass="rounded-button ui-button-flat"
                                                 update="@form"
                                                 action="#{cc.removeMessage(jmsMessage)}"/>
                                <p:tooltip for="@previous" value="Remove JMS message."/>
                            </p:column>
                        </p:dataTable>
                    </ui:fragment>
                    <ui:fragment rendered="#{cc.error}">
                        Could not retrieve JMS information.
                    </ui:fragment>
                </p:panel>
            </div>
        </composite:implementation>
    </h:body>
</html>