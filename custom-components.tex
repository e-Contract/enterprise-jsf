% Enterprise JSF project.
%
% Copyright 2022 e-Contract.be BV. All rights reserved.
% e-Contract.be BV proprietary/confidential. Use is subject to license terms.

\chapter{Custom Components}

\section{Tag Library}

We structure the application as deployable EAR.

Parent POM of our project.
\lstinputlisting[language=XML]{helloworld-ear/pom.xml}

The POM of our tag library JAR module looks as follows.
\lstinputlisting[language=XML]{helloworld-ear/taglib/pom.xml}

The POM of our WAR module looks as follows.
\lstinputlisting[language=XML]{helloworld-ear/war/pom.xml}

The content of the WAR is similar to the initial example.

The POM of our deployable EAR module looks as follows.
\lstinputlisting[language=XML]{helloworld-ear/ear/pom.xml}

The tag library itself is a regular JAR with some additional structure.
The most important file here is our \texttt{src/main/resources/META-INF/ejsf.taglib.xml} tag library descriptor file:
\lstinputlisting[language=XML]{helloworld-ear/taglib/src/main/resources/META-INF/ejsf.taglib.xml}
You can name this file anyway you want, as long as it ends with \texttt{.taglib.xml}.

Compile the example via:
\begin{lstlisting}[language=bash]
	cd helloworld-ear
	mvn clean install
\end{lstlisting}

Deploy the \texttt{helloworld-ear} EAR to the application server via:
\begin{lstlisting}[language=bash]
	cd ear
	mvn wildfly:deploy
\end{lstlisting}

Check out the deployed application within a web browser by navigating to:

http://localhost:8080/helloworld-ear/

\section{Validator}

We start off with our first custom JSF component, a validator.
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleValidator.java}

Notice that we register this custom validator within our \texttt{.taglib.xml} tag library descriptor.

Example usage of our custom validator is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/validation.xhtml}

\subsection{Validator Parameters}

The custom JSF  validator with a parameter attribute looks as follows.
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ParameterValidator.java}

Notice that we register this custom validator within our \texttt{.taglib.xml} tag library descriptor.

Example usage of our custom validator is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/validation-parameter.xhtml}

\section{Output Component}

Source code of our custom output JSF component:
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleOutput.java}

Important here is to notice that we are setting the \texttt{id} attribute on our \texttt{span} HTML element to the value of client id.
This is required so that the JSF AJAX javascript code can find our JSF component for updates.

Example usage of our custom output JSF component is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/output.xhtml}

Notice that we selectively update our custom output component via the \texttt{render="output"} attribute on \texttt{f:ajax}.

\subsection{Output Component with Style}

In this example, we will create an output component that has been styled via a CSS file.
Suppose we have an enumerate, which we want to visualize using different colors.
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleEnum.java}

The JSF output component looks as follows:
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleStyledOutput.java}

With the corresponding CSS resource,
\lstinputlisting[language=CSS]{helloworld-ear/taglib/src/main/resources/META-INF/resources/ejsf/example-styled-output.css}

We can use this custom output component as follows,
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/output-styled.xhtml}

With the corresponding CDI controller,
\lstinputlisting[language=Java]{helloworld-ear/war/src/main/java/be/e_contract/jsf/helloworld/EnumOutputController.java}


\section{Input Component}

Source code of our custom input JSF component:
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleInput.java}

Notice again that we put an explicit \texttt{id} attribute containing the client id on our HTML output element so JSF AJAX updates can locate our component.

Our \texttt{input} element has a \texttt{name} attribute used to locate the request parameter during the \texttt{decode} phase.

Notice the usage of \texttt{getSubmittedValue()} and \texttt{setSubmittedValue()} during encoding and decoding.
The submitted value only gets propagated towards the actual value in case all input validators are happy.
Upon an input validation error, the component keeps working on the submitted value.

Example usage of our custom input JSF component is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/input.xhtml}

\section{AJAX Events}

Source code of our custom JSF component that can fire AJAX events is given below:
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleAjax.java}

Example usage of our custom JSF component is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/ajax.xhtml}

With the corresponding CDI controller:
\lstinputlisting[language=Java]{helloworld-ear/war/src/main/java/be/e_contract/jsf/helloworld/AjaxController.java}

\subsection{Custom AJAX Events}

One can also create custom AJAX Events that can contain component specific parameters.
For example,
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleAjaxBehaviorEvent.java}

This custom AJAX event is passed as parameter to the CDI bean listener method as shown below.
\lstinputlisting[language=Java]{helloworld-ear/war/src/main/java/be/e_contract/jsf/helloworld/AjaxCustomEventController.java}

The following example JSF component demonstrates how to fire such custom AJAX JSF events.
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleAjaxEventComponent.java}

With the corresponding Javascript resource file:
\lstinputlisting[language=Javascript]{helloworld-ear/taglib/src/main/resources/META-INF/resources/ejsf/example-ajax-event.js}

Example usage of our custom JSF component is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/ajax-event.xhtml}

\section{JSF Component with client-side API}
The JSF component source code,
\lstinputlisting[language=Java]{helloworld-ear/taglib/src/main/java/be/e_contract/jsf/taglib/ExampleWidget.java}

The \texttt{ejsf-widget.js} Javascript resource:
\lstinputlisting[language=Javascript]{helloworld-ear/taglib/src/main/resources/META-INF/resources/ejsf/ejsf-widget.js}

The \texttt{ejsf-widget-example.js} Javascript resource:
\lstinputlisting[language=Javascript]{helloworld-ear/taglib/src/main/resources/META-INF/resources/ejsf/ejsf-widget-example.js}

Example usage of our custom JSF component is given below.
\lstinputlisting[language=XML]{helloworld-ear/war/src/main/webapp/widget.xhtml}

\section{Tag Handlers}

\section{Composites}

\subsection{Backing Component}